{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Bulk Flight Operations{% endblock %}

{% block extrastyle %}
    <style>
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .dashboard-card { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; }
        .dashboard-card h3 { margin-top: 0; color: #333; border-bottom: 2px solid #0073aa; padding-bottom: 10px; }
        .route-list { max-height: 300px; overflow-y: auto; }
        .route-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .route-item:last-child { border-bottom: none; }
        .route-info { flex: 1; }
        .route-actions { display: flex; gap: 5px; }
        .route-actions .button { padding: 5px 10px; font-size: 11px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 15px 0; }
        .stat-item { text-align: center; padding: 15px; background: #f8f9fa; border-radius: 5px; }
        .stat-number { font-size: 24px; font-weight: bold; color: #0073aa; display: block; }
        .stat-label { font-size: 12px; color: #666; margin-top: 5px; }
        .quick-actions { display: flex; gap: 10px; flex-wrap: wrap; margin: 15px 0; }
        .quick-actions .button { flex: 1; min-width: 200px; padding: 12px; text-align: center; }
    </style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">Home</a>
&rsaquo; Bulk Flight Operations
</div>
{% endblock %}

{% block content %}
<h1>Bulk Flight Operations Dashboard</h1>

<div class="stats-grid">
    <div class="stat-item">
        <span class="stat-number">{{ routes.count }}</span>
        <div class="stat-label">Total Routes</div>
    </div>
    <div class="stat-item">
        <span class="stat-number">{{ routes|length }}</span>
        <div class="stat-label">Active Routes</div>
    </div>
    <div class="stat-item">
        <span class="stat-number">0</span>
        <div class="stat-label">Scheduled Today</div>
    </div>
    <div class="stat-item">
        <span class="stat-number">0</span>
        <div class="stat-label">Round Trips</div>
    </div>
</div>

<div class="quick-actions">
    <a href="/admin/routes/route/add/" class="button default">Create New Route</a>
    <a href="/admin/booking/flight/add/" class="button">Add New Flight</a>
    <a href="/admin/booking/flightschedule/" class="button">Manage Schedules</a>
    <a href="/admin/booking/booking/" class="button">View Bookings</a>
</div>

<div class="dashboard-grid">
    <div class="dashboard-card">
        <h3>Routes Overview</h3>
        <div class="route-list">
            {% for route in routes %}
            <div class="route-item">
                <div class="route-info">
                    <strong>{{ route.from_destination.code }} → {{ route.to_destination.code }}</strong><br>
                    <small>{{ route.from_destination.name }} → {{ route.to_destination.name }}</small><br>
                    <small>{{ route.price }} {{ route.currency }} | {{ route.distance }}km</small>
                </div>
                <div class="route-actions">
                    <a href="/admin/routes/route/{{ route.id }}/bulk-schedules/" class="button">Schedules</a>
                    <a href="/admin/routes/route/{{ route.id }}/create-roundtrip/" class="button">Round Trip</a>
                </div>
            </div>
            {% empty %}
            <p>No routes configured yet. <a href="/admin/routes/route/add/">Create your first route</a>.</p>
            {% endfor %}
        </div>
    </div>
    
    <div class="dashboard-card">
        <h3>Quick Schedule Creation</h3>
        <p>Create monthly schedules for multiple routes efficiently:</p>
        <form method="get" action="/admin/booking/flightschedule/">
            <div style="margin: 15px 0;">
                <label for="route-select">Select Route:</label>
                <select id="route-select" name="flight__route__id__exact" style="width: 100%; margin-top: 5px;">
                    <option value="">-- Select Route --</option>
                    {% for route in routes %}
                    <option value="{{ route.id }}">{{ route.from_destination.code }} → {{ route.to_destination.code }}</option>
                    {% endfor %}
                </select>
            </div>
            <input type="submit" value="View Route Schedules" class="button default">
        </form>
        
        <div style="margin-top: 20px;">
            <h4>Bulk Operations:</h4>
            <ul style="list-style: none; padding: 0;">
                <li style="margin: 5px 0;">
                    <strong>Monthly Schedules:</strong> Create schedules for entire month
                </li>
                <li style="margin: 5px 0;">
                    <strong>Round Trip Routes:</strong> Auto-create return routes
                </li>
                <li style="margin: 5px 0;">
                    <strong>Operational Days:</strong> Configure weekly patterns
                </li>
                <li style="margin: 5px 0;">
                    <strong>Price Multipliers:</strong> Seasonal pricing adjustments
                </li>
            </ul>
        </div>
    </div>
    
    <div class="dashboard-card">
        <h3>Round Trip Management</h3>
        <p>Manage complete round-trip journeys:</p>
        
        {% regroup routes by from_destination as grouped_routes %}
        <div style="max-height: 250px; overflow-y: auto;">
            {% for destination_group in grouped_routes %}
            <div style="margin-bottom: 15px;">
                <h5>From {{ destination_group.grouper.name }}:</h5>
                {% for route in destination_group.list %}
                <div style="margin-left: 15px; padding: 5px 0;">
                    {{ route.to_destination.name }}
                    {% comment "Check for return route" %}
                    {% for return_route in routes %}
                        {% if return_route.from_destination == route.to_destination and return_route.to_destination == route.from_destination %}
                            <span style="color: green;">✓ Round Trip</span>
                            {% break %}
                        {% endif %}
                    {% empty %}
                        <a href="/admin/routes/route/{{ route.id }}/create-roundtrip/" style="font-size: 11px; margin-left: 10px;">+ Create Return</a>
                    {% endfor %}
                    {% endcomment %}
                    <a href="/admin/routes/route/{{ route.id }}/create-roundtrip/" style="font-size: 11px; margin-left: 10px;">+ Create Return</a>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="dashboard-card">
        <h3>Recent Activity</h3>
        <p>Latest flight operations:</p>
        <ul style="list-style: none; padding: 0; font-size: 13px;">
            <li style="padding: 5px 0; border-bottom: 1px solid #eee;">No recent activity</li>
            <li style="padding: 5px 0; color: #666;">Configure routes and schedules to see activity</li>
        </ul>
        
        <div style="margin-top: 20px;">
            <h4>Next Steps:</h4>
            <ol style="font-size: 13px;">
                <li>Create your first route</li>
                <li>Set up monthly schedules</li>
                <li>Configure round-trip options</li>
                <li>Monitor booking performance</li>
            </ol>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add some interactivity for better UX
    const routeItems = document.querySelectorAll('.route-item');
    
    routeItems.forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#f8f9fa';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.backgroundColor = 'transparent';
        });
    });
});
</script>
{% endblock %}